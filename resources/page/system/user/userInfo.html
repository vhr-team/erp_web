<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ä¸ªäººç”¨æˆ·ä¿®æ”¹</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../../lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="../../../css/layuicmspublic.css" media="all">
    <link rel="stylesheet" href="../../../css/public.css" media="all">

    <link rel="stylesheet" href="../../../js/lay-module/PearAdmin/css/pearButton.css">
    <link rel="stylesheet" href="../../../js/lay-module/PearAdmin/css/pearOper.css">
    <style>
        .pear-container{
            background-color: whitesmoke;
            margin: 10px;
        }
        #febs-user-profile #user-profile, #febs-user-profile .user-profile-card {
            display: inline-block;
        }

        #febs-user-profile #user-img, #febs-user-profile #user-info {
            display: inline-block;
            float: left;
        }

        #febs-user-profile #user-img img {
            width: 7rem;
            margin: 1rem;
            border-radius: 50%;
            cursor: pointer;
        }

        #febs-user-profile #user-info {
            margin: .95rem 0 .95rem 1.2rem;
        }

        #febs-user-profile #user-info div {
            margin: 3px 0;
            max-width: 22rem;
        }

        #febs-user-profile #options-wrapper {
            text-align: center;
            margin-top: 3rem;
        }

        #febs-user-profile #update-user-info {
            cursor: pointer;
            margin-left: -1rem;
        }

        #febs-user-profile #options-wrapper a {
            padding: 4px 6px;
            color: rgba(0, 0, 0, 0.65);
            border: 1px solid #d9d9d9;
            border-radius: 2px;
        }

        #febs-user-profile #options-wrapper a:hover {
            color: #40a9ff;
            border-color: #40a9ff;
        }

        #febs-user-profile .layui-form-item {
            margin-bottom: 0;
            margin-top: 20px;
        }

        .layuimini-container {
            border: 1px solid #f2f2f2;
            border-radius: 5px;
            background-color: #ffffff;
            height: 500px;
        }
    </style>
    <link rel="stylesheet" href="../../../js/lay-module/febs/css/febs.css">
</head>
<body>
<div class="layuimini-container" id="febs-user-profile">
    <br>
    <form class="layui-form layui-row" method="post" id="dataFrm" lay-filter="dataFrm">
        <div class="layui-col-md3 layui-col-xs12 user_right">
            <div class="layui-upload-list">
                <img alt="å¤´åƒ" title="ç‚¹æˆ‘æ›´æ¢å¤´åƒ" class="layui-upload-img layui-circle userFaceBtn userAvatar" id="userFace">
            </div>
            <div id="options-wrapper">
                <div id="update-user-info">
                    <a href="javascript:;" class="userFaceBtn">
                        <span class="layui-icon layui-icon-setting"></span>
                        ææŒ‡ä¸€ç®—ï¼Œè¦æ¢å¤´åƒäº† ğŸ˜Š
                    </a>
                </div>
            </div>
        </div>
        <div class="layui-col-md6 layui-col-xs12">
            <div class="layui-form-item">
                <label class="layui-form-label">ç™»é™†å</label>
                <div class="layui-input-block">
                    <input type="hidden" name="id"/>
                    <input type="text" value="" name="loginname" disabled class="layui-input layui-disabled">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">ç”¨æˆ·å§“å</label>
                <div class="layui-input-block">
                    <input type="text" value="" name="name" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">ç”¨æˆ·åœ°å€</label>
                <div class="layui-input-block">
                    <input type="text" value="" name="address" placeholder="è¯·è¾“å…¥ç”¨æˆ·åœ°å€" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">ä¸ªäººå¤‡æ³¨</label>
                <div class="layui-input-block">
                    <textarea placeholder="è¯·è¾“å…¥ä¸ªäººå¤‡æ³¨" name="remark" class="layui-textarea myself"></textarea>
                </div>
            </div>
            <div class="layui-form-item" pane="">
                <label class="layui-form-label">æ€§åˆ«</label>
                <div class="layui-input-block userSex">
                    <input type="radio" name="sex" value="1" title="ç”·" checked="">
                    <input type="radio" name="sex" value="0" title="å¥³">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button type="button" class="layui-btn" lay-submit="" id="changeUser" lay-filter="changeUser">ç«‹å³æäº¤
                    </button>
                    <button type="reset" class="layui-btn layui-btn-primary">é‡ç½®</button>
                </div>
            </div>
        </div>
    </form>
</div>
<script src="../../../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
<script src="../../../lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script src="../../../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
<script src="../../../lib/jq-module/jquery.particleground.min.js" charset="utf-8"></script>
<script src="../../../lib/common/jquery.cookie.min.js" charset="utf-8"></script>
<script src="../../../lib/common/common.js" charset="utf-8"></script>

<script>
    layui.use(['form', 'table', 'laydate', 'layer', 'upload'], function () {
        var form = layui.form;
        var table = layui.table;
        var laydate = layui.laydate;
        var layer = layui.layer;
        var upload = layui.upload;

        //æŸ¥è¯¢å½“å‰ç”¨æˆ·
        $.get(api + "user/getCurrentUser", function (res) {
            $("#userFace").attr("src", baseUrl + res.data.imgpath);
            form.val("dataFrm", res.data);
        });

        form.on("submit(changeUser)", function (data) {
            //loadingå±‚
            var index = layer.load(1, {
                shade: [0.5, '#fff'] //0.1é€æ˜åº¦çš„ç™½è‰²èƒŒæ™¯     RGB  red  green blue
            });
            var params = $("#dataFrm").serialize();
            $.post(api + "user/updateUser", params, function (res) {
                layer.msg(res.msg);
                layer.close(index);
            })
            return false;
        })


        //ç»‘å®šæ–‡ä»¶ä¸Šä¼ çš„æ§ä»¶
        //æ™®é€šå›¾ç‰‡ä¸Šä¼ 
        var uploadInst = upload.render({
            elem: '.userFaceBtn'
            , url: api + 'file/uploadFile'
            , field: "mf" //è®¾å®šæ–‡ä»¶åŸŸçš„å­—æ®µå
            , acceptMime: 'image/*'
            , before: function (obj) {
                //é¢„è¯»æœ¬åœ°æ–‡ä»¶ç¤ºä¾‹ï¼Œä¸æ”¯æŒie8
                obj.preview(function (index, file, result) {
                    $('#userFace').attr('src', result); //å›¾ç‰‡é“¾æ¥ï¼ˆbase64ï¼‰
                });
            }
            , done: function (res) {
                //å¦‚æœä¸Šä¼ å¤±è´¥
                if (res.code > 0) {
                    return layer.msg('ä¸Šä¼ å¤±è´¥');
                }
                //ä¸Šä¼ æˆåŠŸ
            }
            , error: function () {
                //æ¼”ç¤ºå¤±è´¥çŠ¶æ€ï¼Œå¹¶å®ç°é‡ä¼ 
                var resultText = $('#resultText');
                resultText.html('<span style="color: #FF5722;"> ä¸Šä¼ å¤±è´¥ </span> <a class="layui-btn layui-btn-xs demo-reload">é‡è¯•</a>');
                resultText.find('.demo-reload').on('click', function () {
                    uploadInst.upload();
                });
            }
        });


    });
</script>
</body>
</html>
